# Initramfs compression with zstd
packages:
  - zstd

postprocess:
  - |
    #!/usr/bin/env bash
    set -xeuo pipefail

    install -dm 0755 -o 0 -g 0 /usr/lib/dracut/dracut.conf.d

  - |
    #!/usr/bin/env bash
    set -xeuo pipefail

    cat > /usr/lib/dracut/dracut.conf.d/20-atomic-zstd.conf << 'EOF'
    # Compress initrd with zstd.  dracut defaults to -15, but we want the
    # maximum reasonable compression, so override the command line to use
    # dracut's defaults along with -19.
    compress="zstd -19 -q -T0"
    EOF
